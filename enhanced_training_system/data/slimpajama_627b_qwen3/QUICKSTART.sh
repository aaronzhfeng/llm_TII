#!/bin/bash
# Quick Start Guide for SlimPajama-627B Dataset Preparation
# 
# This script provides example commands.
# DO NOT RUN THIS SCRIPT DIRECTLY - copy the relevant commands!

echo "====================================================================="
echo "SlimPajama-627B Quick Start Guide"
echo "====================================================================="
echo ""

echo "---------------------------------------------------------------------"
echo "1. TEST MODE - Quick test (recommended first!)"
echo "---------------------------------------------------------------------"
echo "Command:"
echo "  python3 prepare.py --max_examples 1000"
echo ""
echo "Description:"
echo "  - Processes 1000 examples (~5 minutes)"
echo "  - Verifies setup works"
echo "  - Auto-detects CPU cores (224 on your system)"
echo ""

echo "---------------------------------------------------------------------"
echo "2. FULL DATASET - Two-Phase Approach (RECOMMENDED)"
echo "---------------------------------------------------------------------"
echo "Phase 1 - Download Only (avoids rate limits):"
echo "  python3 prepare.py --download_only"
echo ""
echo "Phase 2 - Tokenize Only (full CPU power):"
echo "  python3 prepare.py --tokenize_only"
echo ""
echo "Description:"
echo "  Phase 1: Downloads 895GB with single thread (8-24 hours)"
echo "  Phase 2: Tokenizes with 224 cores (2-4 hours)"
echo "  Can stop/resume between phases"
echo ""
echo "Requirements:"
echo "  - Disk: ~2TB (895GB raw + 1.2TB tokenized)"
echo "  - Network: 895GB download (Phase 1 only)"
echo "  - RAM: ~32GB (Phase 2)"
echo ""

echo "---------------------------------------------------------------------"
echo "2b. ALTERNATIVE - Single Command (One-Phase)"
echo "---------------------------------------------------------------------"
echo "Command:"
echo "  python3 prepare.py"
echo ""
echo "Description:"
echo "  - Downloads + tokenizes in one go (10-28 hours)"
echo "  - Same as running Phase 1 + Phase 2 sequentially"
echo ""

echo "---------------------------------------------------------------------"
echo "3. RUN IN BACKGROUND (for long processes)"
echo "---------------------------------------------------------------------"
echo "Commands:"
echo "  # Start tmux session"
echo "  tmux new -s slimpajama"
echo ""
echo "  # Inside tmux, run preparation"
echo "  python3 prepare.py 2>&1 | tee preparation.log"
echo ""
echo "  # Detach: Ctrl+B, then D"
echo "  # Reattach: tmux attach -t slimpajama"
echo ""

echo "---------------------------------------------------------------------"
echo "4. VERIFICATION"
echo "---------------------------------------------------------------------"
echo "Commands:"
echo "  # Check files"
echo "  ls -lh *.bin *.pkl"
echo ""
echo "  # Check metadata"
echo "  python3 -c 'import pickle; print(pickle.load(open(\"meta.pkl\", \"rb\")))'"
echo ""
echo "  # Verify size"
echo "  du -h train.bin  # Should be ~1.2TB"
echo ""

echo "====================================================================="
echo "RECOMMENDED WORKFLOW (Two-Phase to Avoid Rate Limits)"
echo "====================================================================="
echo ""
echo "Step 1: Test"
echo "  cd /raid/zhf004/llm_TII/enhanced_training_system/data/slimpajama_627b_qwen3"
echo "  python3 prepare.py --max_examples 1000"
echo ""
echo "Step 2: Download phase (overnight, in tmux)"
echo "  tmux new -s slimpajama_download"
echo "  python3 prepare.py --download_only 2>&1 | tee download.log"
echo "  # Detach: Ctrl+B, then D"
echo ""
echo "Step 3: Check download progress"
echo "  tmux attach -t slimpajama_download"
echo "  # Or: tail -f download.log"
echo "  # Or: watch -n 60 'du -sh ~/.cache/huggingface/datasets'"
echo ""
echo "Step 4: Tokenize phase (after download completes)"
echo "  tmux new -s slimpajama_tokenize"
echo "  python3 prepare.py --tokenize_only 2>&1 | tee tokenize.log"
echo "  # Detach: Ctrl+B, then D"
echo ""
echo "Step 5: Verify"
echo "  ls -lh *.bin *.pkl"
echo ""
echo "Step 6: Update training config"
echo "  # Edit: config/full_qwen3_1.8b_b200_optimal.py"
echo "  # Set: dataset = 'slimpajama_627b_qwen3'"
echo ""
echo "Step 7: Train!"
echo "  cd /raid/zhf004/llm_TII/enhanced_training_system"
echo "  python3 train.py config/full_qwen3_1.8b_b200_optimal.py"
echo ""
echo "====================================================================="

